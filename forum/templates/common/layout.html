<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta name="format-detection" content="telephone=no"/>
    <title>{% block title %}F2E - 前端技术社区{% endblock %}</title>
    <script type="text/javascript" src="/static/js/base/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/static/js/base/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/base/in-min.js"></script>
    <script type="text/javascript" src="/static/js/base/jquery.cookie.js"></script>
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.min.css"/>
    {% compressed_css 'main' %}
    <link rel="apple-touch-icon" href="/static/images/f2e.im.icon.png">

    {% block stylesheet %}{% endblock %}
    {% block javascript %}{% endblock %}

    <script type="text/javascript">
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            crossDomain: false, // obviates need for sameOrigin test
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type)) {
                    var csrftoken = $.cookie('csrftoken');
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
        jQuery(document).ready(function () {
            $('.J_search').submit(function (e) {
                var _node = $(this);
                var query = _node.find('input').val();
                e.preventDefault();
                window.open('http://www.google.com/search?q=site:f2e.im/t%20' + query, "_blank");
            });
        });
    </script>
</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top top-navbar">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="{{url('index')}}">F2E</a>

            <div class="divider-vertical"></div>
            {% if user.is_authenticated() %}
            {% set notifications_count = user.unread_notifications().count() %}
            {% if  notifications_count %}
            <a href="{{ url('notifications') }}" class="notification-indicator tooltipped downwards contextually-unread"
               title="{{ user.username }}，你有{{ notifications_count }}条未读提醒，去看看吧">
                <span class="mail-status unread"></span>
            </a>
            {% else %}
            <a href="{{ url('notifications') }}" class="notification-indicator tooltipped downwards" title="暂时没有未读提醒">
                <span class="mail-status"></span>
            </a>
            {% endif %}
            <div class="divider-vertical"></div>
            {% endif %}
            <div class="nav-collapse collapse">

                {% set navigation_bar = [
                (url('topic_list'), 'topics', '社区'),
                (url('blog_list'), 'blogs', '文章'),
                ('/static/pages/timeline/index.html', 'timeline', '大事记'),
                ('/static/pages/nav/index.html', 'nav', '导航'),
                ] -%}

                {% set active_page = active_page or 'index' -%}

                <ul class="nav">
                    {% for href, id, caption in navigation_bar %}
                    <li
                    {% if id == active_page %} class="active"{% endif %}>
                    <a href="{{ href|e }}">{{ caption|e }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <!--/.nav-collapse -->
            <form class="navbar-search pull-left J_search">
                <input type="text" class="search-query" placeholder="搜索">
            </form>
            <div class="nav-collapse collapse pull-right">
                <ul class="nav account-menu">
                    {% if user.is_authenticated() %}
                    <li>
                        <a href="{{ url('user', name=user.get_username()) }}" class="avatar">
                            <img src="{{ user.avatar.small.url}}"
                                 width="20" height="20">
                        </a>
                    </li>
                    <li><a href="{{ user.get_absolute_url() }}">{{ user.get_username() }}</a>
                    </li>
                    <li>
                        <a href="/setting">
                            <span class="octicon octicon-tools"></span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url('logout') }}">
                            <span class="octicon octicon-log-out"></span>
                        </a>
                    </li>
                    {% else %}
                    <li>
                        <a href="{{url('login')}}">
                            <span class="octicon octicon-log-in"></span>
                        </a>
                    </li>
                    <li><a href="{{url('register')}}" class="btn btn-small">注册</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid container mt15">
    {{ messages|dump_messages }}
    {% if form %}
        {{form.errors|dump_errors}}
    {% endif %}
    {% block messages %}

    {% endblock %}

    <div class="row-fluid">
        <div class="span9 left">
            {% block main %}{% endblock %}
        </div>

        <div class="span3 right">
            {% block sidebar %}{% endblock %}
        </div>
    </div>
</div>

{% include 'common/footer.html' %}

</body>
</html>
